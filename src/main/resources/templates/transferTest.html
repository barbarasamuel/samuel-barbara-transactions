<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <meta charset="UTF-8">
    <title>Pay my buddy Transfer</title>
    <link th:href="@{/css/home.css}"
          rel="stylesheet"
    >
    <link th:href="@{/css/style.css}"
          rel="stylesheet"
    >
    <link th:href="@{/css/transfer.css}"
          rel="stylesheet"
    >

</head>

<body>


<header>
    <nav>
        <div><img th:src="@{/img/paymybuddy.PNG}" width="123" alt="Logo Pay my buddy" ></div>
        <div>
            <a th:href="@{/}">Home</a>
            <a th:href="@{/}">Transfer</a>
            <a th:href="@{/profile}">Profile</a>
            <a th:href="@{/contact}">Contact</a>
            <a th:href="@{/logout}">Log off</a>
        </div>
    </nav>
</header>
<main>
    <section>
        <div class="bandeau">
            <p class="bandeau_text">Home / Transfer</p>
        </div>

    </section>
    <section class="centered_section">
        <div><h1>Welcome <span th:text="${username}"></span>!</h1></div>
        <div class="wrapper_sendmoney">
            <form action="#" id="newConnection" method="post" th:action="@{/connection/save}">
                <input id="friendName" type="hidden" th:name="friendName" />
                <input id="addInput" name="addInput" type="hidden" value="" />
                <div class="w_one_sendmoney">Send Money</div>
                <div class="w_two_sendmoney"><button onclick="addConnectionPopup()" type="submit">Add Connection</button></div>

            </form>
            <form action="#" id="newTransaction" method="post" th:action="@{/transactions/save}" th:object="${newTransaction}">
                <!--<form action="#" id="debtorAccount" method="post" th:object="${debtorAccountList}">
                    <select id="hiddenDebtorAccount-select" type="hidden" th:name="idDebtorAccount" required>
                        <option value="" disabled selected>Select a debtor account</option>
                        <option th:each="debtorAccount : ${debtorAccountList}" th:attr="value=${debtorAccount.id}" th:text="${debtorAccount.id}"></option>
                    </select>
                </form>
                <form action="#" id="creditorAccount" method="post" th:object="${creditorAccountList}">
                    <select id="hiddenCreditorAccount-select" type="hidden" th:name="idCreditorAccount" required>
                        <option value="" disabled selected>Select a creditor account</option>
                        <option th:each="creditorAccount : ${creditorAccountList}" th:attr="value=${creditorAccount.id}" th:text="${creditorAccount.id}"></option>
                    </select>
                </form>-->
                <input id="hiddenDescriptionInput" type="hidden" th:name="description" /><!--th:name="${transactionDescription}" th:value="${description}"-->
                <input id="descriptionInput" name="descriptionInput" type="hidden" value="" />
                <table>
                    <thead>
                    </thead>
                    <tbody>
                    <td><div class="wrapper_description" style="background-color:#e0e0e0;">
                        <!--<a th:href="@{/transaction/save}">-->
                        <div class="w_one_description">
                            <select id="debtorAccount-select" th:name="idDebtorAccount" required>
                                <option value="" disabled selected>Select a debtor account</option>
                                <option th:each="debtorAccount : ${debtorAccountList}" th:attr="value=${debtorAccount.id}" th:text="${debtorAccount.id}"></option>
                            </select>
                        </div>
                        <div class="w_two_description">

                            <select id="connection-select" th:name="id" required><!--<select class="element_border" name="connections" id="connection-select" th:field="*{name}">-->
                                <option value="" disabled selected>Select a connection</option>
                                <!--<option th:each="connection : ${connectionsList}" th:value="${connection.id}" th:text="${connection.connectionName}"></option>-->
                                <option th:each="connection : ${connectionsList}" th:attr="value=${connection.id}" th:text="${connection.connectionName}"></option>
                                <!--<option value="option1">Option 1</option>-->
                            </select>

                        </div>
                        <div class="w_three_description">
                            <select id="creditorAccount-select" th:name="idCreditorAccount" required>
                                <option value="" disabled selected>Select a creditor account</option>
                                <option th:each="creditorAccount : ${creditorAccountList}" th:attr="value=${creditorAccount.id}" th:text="${creditorAccount.id}"></option>
                            </select>
                        </div>
                        <div class="w_four_description">
                            <input type="number" id="amount" class="element_border" placeholder="1€" th:name="amount" required/>
                            <!--<label for="amount"></label><input
                            type="number"
                            id="amount"
                            name="amount"
                            class="element_border"
                            placeholder="1€"
                           th:field="*{amount}"
                           />-->

                        </div>
                        <div class="w_five_description">
                            <button type="button" id="button_pay" onclick="payPopup()">Pay</button>
                        </div>
                        <!-- </a>-->
                    </div></td>
                    </tr>
                    </tbody>
                </table>
            </form>
        </div>
    </section>

    <section class="centered_section">
        <form>
            <table id="myTransactionsList" class="element_border">

                <thead>
                <tr>
                    <th>My Transactions</th>
                </tr>
                <tr class="title-element">
                    <th>Date</th>
                    <th>Connection</th>
                    <th>Description</th>
                    <th>Amount</th>
                </tr>
                </thead>
                <tbody><!--onload="listPrinting()">-->

                <tr th:each = "transactions, iter : ${transactionsList}" >
                    <td th:text = "${#dates.format(transactions.transactionDate,'dd/MM/yyyy')}"></td>
                    <td th:text = "${transactions.connectionName}"></td>
                    <td th:text = "${transactions.description}"></td>
                    <td th:text = "${transactions.amount}"></td>
                </tr><!---->
               </tbody>
           </table>
            <!--<div>
                <button class="pagination" onclick="goToPage(1)">&#171;</button>
                <button class="pagination" onclick="goToPage(1)">1</button>
                <button class="pagination" onclick="goToPage(2)">2</button>
                <button class="pagination" onclick="goToPage(3)">3</button>
                <button class="pagination" onclick="goToPage(4)">4</button>
                <button class="pagination" onclick="goToPage(5)">5</button>
                <button class="pagination" onclick="goToPage(totalPages)">&#187;</button>
            </div>-->
            <!--<script>
                document.addEventListener('DOMContentLoaded', function() {
                    const table = document.getElementById('myTransactionsList');
                    const rowsPerPage = 3;
                    const rows = table.querySelectorAll('tbody tr');
                    const totalPages = Math.ceil(rows.length / rowsPerPage);
                    let currentPage = 1;

                    function displayPage(page) {
                        const start = (page - 1) * rowsPerPage;
                        const end = start + rowsPerPage;
                        rows.forEach((row, index) => {
                            row.style.display = (index >= start && index < end) ? '' : 'none';
                        });
                    }

                    function createPagination() {
                        const pagination = document.createElement('div');
                        pagination.id = 'pagination';

                        // Bouton "Début"
                        const startButton = document.createElement('button');
                        startButton.textContent = '<<';
                        startButton.classList.add('pagination');
                        startButton.addEventListener('click', function() {
                            let currentPage = 1;
                            displayPage(currentPage);
                        });
                        pagination.appendChild(startButton);

                        // Boutons de pages numérotées
                        for (let i = 1; i <= totalPages; i++) {
                            const pageButton = document.createElement('button');
                            pageButton.textContent = i;
                            pageButton.classList.add('pagination');
                            pageButton.addEventListener('click', function() {
                                let currentPage = i;
                                displayPage(currentPage);
                            });
                            pagination.appendChild(pageButton);
                        }

                        // Bouton "Fin"
                        const endButton = document.createElement('button');
                        endButton.textContent = '>>';
                        endButton.classList.add('pagination');
                        endButton.addEventListener('click', function() {
                            let currentPage = totalPages;
                            displayPage(currentPage);
                        });
                        pagination.appendChild(endButton);

                        table.parentNode.insertBefore(pagination, table.nextSibling);
                    }

                    displayPage(currentPage);
                    createPagination();
                });
            </script>-->
            <script>
                const table = document.getElementById('myTransactionsList');
        const rowsPerPage = 3;
        const rows = table.querySelectorAll('tbody tr');
        const totalPages = Math.ceil(rows.length / rowsPerPage);
        var currentPage = 1;

function displayPage(page) {
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            rows.forEach((row, index) => {
                row.style.display = (index >= start && index < end) ? '' : 'none';
            });

        }
function createPagination() {
            const pagination = document.createElement('div');
            pagination.id = 'pagination';

            // Bouton "Début"
            const startButton = document.createElement('button');
            startButton.textContent = '<<';
            startButton.classList.add('pagination');
            startButton.addEventListener('click', function() {
                currentPage = 1;
                displayPage(currentPage);
                alert(currentPage);
                //displayPage(1);
            });
            pagination.appendChild(startButton);

            // Boutons de pages numérotées
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.add('pagination');
                pageButton.addEventListener('click', function() {
                    currentPage = i;
                    displayPage(currentPage);
                    alert(currentPage);
                    //displayPage(i);
                });
                pagination.appendChild(pageButton);
            }

            // Bouton "Fin"
            const endButton = document.createElement('button');
            endButton.textContent = '>>';
            endButton.classList.add('pagination');
            endButton.addEventListener('click', function() {
                currentPage = totalPages;
                displayPage(currentPage);
                alert(currentPage);
                //displayPage(totalPages);
            });
            pagination.appendChild(endButton);

            table.parentNode.insertBefore(pagination, table.nextSibling);
            return currentPage;
        }

        createPagination();
        alert(currentPage);

window.onload = function() {
            alert(currentPage);
            displayPage(currentPage);
        };
       // document.addEventListener('DOMContentLoaded', function() {
        //const table = document.getElementById('myTransactionsList');
        //const rowsPerPage = 3;
        //const rows = table.querySelectorAll('tbody tr');
        //const totalPages = Math.ceil(rows.length / rowsPerPage);
        //let currentPage = 1;

        /*function displayPage(page) {
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            rows.forEach((row, index) => {
                row.style.display = (index >= start && index < end) ? '' : 'none';
            });
        }*/
//alert(currentPage);
  //      displayPage(currentPage);
        //createPagination();
    //});

            </script>
       </form>
   </section>
</main>
<footer>
</footer>
<script>
    function addConnectionPopup(){
        var addInput = prompt("Write the new connection");
        if(addInput!=null){
            /*var value = document.getElementById("addInput").value;
            document.getElementById("friendName").value = value;*/
            document.getElementById("friendName").value = addInput;
            document.getElementById("newConnection").getElementById("friendName").value.submit();
        }
    }
    function payPopup(){
        var descriptionInput = prompt("Write the transactions description");
        if(descriptionInput!=null){
            document.getElementById("hiddenDescriptionInput").value = descriptionInput;
            document.getElementById("hiddenDescriptionInput").value = descriptionInput;
            document.getElementById("hiddenDescriptionInput").value = descriptionInput;
            document.getElementById("newTransaction").submit();
        }
</script><!--<script>function displayTablePage(page){
    let transactionsList = "${transactionsList}";
        for (let i = 0; i < transactionsList.length; i+=3){
             const row = document.createElement('tr');

             for (let j = i; j < i+3 && j < transactionsList.length; j++){

                 const cell1 = document.createElement('td');
                 cell1.innerText = transactionsList[0,0];//transactions.#dates.format(transactions.transactionDate,'dd/MM/yyyy');
                 row.appendChild(cell1);

                 const cell2 = document.createElement('td');
                 cell2.innerText = transactions.connectionName;
                 row.appendChild(cell2);

                 const cell3 = document.createElement('td');
                 cell3.innerText = transactions.description;
                 row.appendChild(cell3);

                 const cell4 = document.createElement('td');
                 cell4.innerText = transactions.amount;
                 row.appendChild(cell4);
                 console.log("dans boucle");
             }

             tableBody.appendChild(row);
         }

     }
     function goToPage(page){
         console.log("dans goToPage");
         if (page >= 1 && page <= totalPages) {
              displayTablePage(page);
          }/**/
     }
     function listPrinting(){
        console.log("dans listPrinting");
        displayTablePage(currentPage);
        }
    }
</script>-->
</body>
</html>
